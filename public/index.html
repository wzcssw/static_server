<html>
<head>
    <title>Lottery</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0" />
    <meta name="format-detection" content="telephone=no" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        .lotterybox{
            height: 100%;
        }
        .mask {       
            position: absolute; top: 0px; filter: alpha(opacity=30); background-color: #000;     
            z-index: 1002; left: 0px;     
            opacity:0.95; -moz-opacity:0.5;     
        }    
    </style>
</head>

<body>
    <!-- 遮罩层 -->
    <div id="mask" class="mask" style="text-align:center;display: none;" onclick="hideMask()">
            <img style="display: none;width: 40%;margin-top: 10%" id="first" src="/img/%E6%8A%BD%E5%A5%96%E7%AC%AC%E4%B8%80%E8%BD%AE.png" alt="第一轮">
            <img style="display: none;width: 40%;margin-top: 10%" id="second" src="/img/%E6%8A%BD%E5%A5%96%E7%AC%AC%E4%BA%8C%E8%BD%AE.png" alt="第二轮">
            <img style="display: none;width: 40%;margin-top: 10%" id="third" src="/img/%E6%8A%BD%E5%A5%96%E7%AC%AC%E4%B8%89%E8%BD%AE.png" alt="第三轮">
            <img style="display: none;width: 40%;margin-top: 10%" id="fourth" src="/img/%E5%87%86%E5%A4%87%E6%8A%BD%E5%8F%96%E4%B8%80%E7%AD%89%E5%A5%96.png" alt="一等">
            <img style="display: none;width: 40%;margin-top: 10%" id="special" src="/img/thanks_1.png" alt="特等">
            <div>
                <img style="display: none;width: 20%;margin-top: 10%" id="weiqi" src="/img/%E5%88%98%E4%BC%9F%E5%A5%87_last.jpg">
                <img style="display: none;width: 20%;margin-top: 10%" id="wang" src="/img/%E6%B1%AA%E8%80%81%E5%B8%88_last.jpg">
            </div>
    </div>
    <!-- Zepto or jQuery -->
    <!-- <script src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script> -->
    <script src="/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="./dist/lottery.min.css" />
    <script src="./vendor/confetti.js"></script>
    <script src="./vendor/material-avatar.js"></script>
    <script src="./vendor/move.min.js"></script>
    <script src="./dist/lottery.js"></script>
    <link rel="stylesheet" href="./dist/animate.css" />
    <!-- <h1 class="animated infinite bounceInDown">Example</h1> -->
    <div class="lotterybox"></div>
    
    <!-- ROCK ON -->
    <audio id="bgMusic" style="display: none">
        <!-- <source = src="http://tongxin-dev-image.oss-cn-beijing.aliyuncs.com/bg.mp3" type="audio/mp3"> -->
            <source = src="/music/Kirby's%20Dream%20Band%20-%20Dream%20Land%20Days.mp3" type="audio/mp3">
    </audio>
    <audio id="startMusic" style="display: none" loop="loop">
        <source = src="/music/start.mp3" type="audio/mp3">
    </audio>
    <audio id="stopMusic" style="display: none">
        <source = src="/music/stop.mp3" type="audio/mp3">
    </audio>
    <audio id="last_one_music" style="display: none" loop="loop">
        <source = src="/music/last_one_music.mp3" type="audio/mp3">
    </audio>
    <img src="/img/dog_logo.png" style="position:absolute;left:0;bottom:0;width: 12%">
    <script>
        var titleImage = "";
        $().ready(function(){
            var audio = document.getElementById("bgMusic");
            var last_one_music = document.getElementById("last_one_music");
            //播放(继续播放)
            audio.play();
            
            var api_url = '/childs'
            var term = getUrlParam("term")
            var option = getUrlParam("reset")
            if (term!=null){
                term = parseInt(term);
            }else{
                alert("未输入中奖人数");
            }
            if(option!=null){
                    api_url = api_url + "?option=clear"
                    if(term=="1"){
                        audio.pause();
                        last_one_music.play();
                    }
            }

            if(option!=null && term==1){
                titleImage = "special";
            }else{
                switch (term) {
                    case 20:
                        titleImage = "first";
                        break;
                    case 15:
                        titleImage = "second";
                        break;
                    case 4:
                        titleImage = "third";
                        break;
                    case 1:
                        titleImage = "fourth";
                        break;
                    default:
                        break;
                }
            }
            showTitle(titleImage);
            
            
            $.lottery({
                el: '.lotterybox',
                api: api_url,
                once: true,
                subtitle: "company",
                // desc: "title",
                timeout: 40000000,
                number: term,
                speed: 200
            });

            window.setItemSize(108);
        });
            
        // 获取url中的参数
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        };
        // 显示遮罩层
        function showMask(){     
            $("#mask").css("height",$(document).height());     
            $("#mask").css("width",$(document).width());     
            $("#mask").fadeIn(500);
        };
        // 隐藏遮罩层  
        function hideMask(){
            $('#'+titleImage).addClass('animated fadeOutUp'); 
            $("#mask").fadeOut(1000);     
        };
        // 标题页
        function showTitle(titleImage){     
            showMask();
            if(titleImage=="special"){
                $('#'+titleImage).fadeIn(3000,function(){
                    $('#weiqi').fadeIn(1800,function(){
                        $('#wang').fadeIn(1800,function(){});
                    });
                });
            }else{
                $('#'+titleImage).show();
                $('#'+titleImage).addClass('animated bounceInDown');
            }
        };
        // 感谢页
        function thanks(){
            alert(0)
        };
    </script>

</body>

</html> 